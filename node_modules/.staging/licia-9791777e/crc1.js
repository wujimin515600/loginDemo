var type = require('./type');
var isStr = require('./isStr');
var utf8 = require('./utf8');
var strToBytes = require('./strToBytes');

exports = function(input, previous) {
    return exports.signed(input, previous) >>> 0;
};

exports.signed = function(input, previous) {
    input = exports.transInput(input);
    var crc = ~~previous;
    var accum = 0;

    for (var i = 0, len = input.length; i < len; i++) {
        var byte = input[i];
        accum += byte;
    }

    crc += accum % 256;
    return crc % 256;
};

exports.transInput = function(input) {
    if (isStr(input)) {
        input = strToBytes(utf8.encode(input));
    } else if (type(input) !== 'uint8array') {
        input = new Uint8Array(input);
    }

    return input;
};

module.exports = exports;
